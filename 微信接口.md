### 微信accessToken获取地址

```html
https://api.weixin.qq.com/sns/oauth2/access_token
```

```java
public Map<String, Object> getOauth2AccessToken(String code) {
    Map<String, Object> map1 = new HashMap<>();
    HashMap<String, String> headers = new HashMap<>();
    headers.put("Content-Type", "application/json");
    map1.put("appid", appId);
    map1.put("secret", secret);
    map1.put("code", code);
    map1.put("grant_type", "authorization_code");
    log.info("weChatOauth2TokenURL -> " + map1);
    String result = HttpUtil.createGet(SystemConstant.weChatOauth2TokenURL)
        .addHeaders(headers)
        .form(map1)
        .execute()
        .body();
    log.info("微信获取accessToken返回值{}", result);
    String accessToken = JSONObject.parseObject(result).getString("access_token");
    String openID = JSONObject.parseObject(result).getString("openid");
    Map<String, Object> resultMap = new HashMap();
    resultMap.put("accessToken", accessToken);
    resultMap.put("openID", openID);
    return resultMap;
}
```

### 微信accessToken

```html
https://api.weixin.qq.com/cgi-bin/token?" +
            "grant_type=client_credential&appid=${APPID}&secret=${APPSECRET}
```

```java
{
    //获取accessToken
    List<String> accessList = new ArrayList<>();
    accessList.add(appId);
    accessList.add(appSecret);
    String accessTokenBody = HttpUtil
        .createGet(RedisKey.getKey(SystemConstant.weChatAccessToken, accessList))
        .execute()
        .body();
    log.info("微信端accessTokenBody={}", accessTokenBody);
    String accessToken = JSONObject.parseObject(accessTokenBody)
        .getString("access_token");
    log.info("微信端accessToken={}", accessToken);
}
```

### 微信unionId获取地址

```html
https://api.weixin.qq.com/sns/userinfo
```

```java
public Map<String, Object> getWeChatUnionId(String accessToken, String openId) {
    Map<String, Object> map = new HashMap<>();
    map.put("access_token", accessToken);
    map.put("openid", openId);
    map.put("lang", "zh_CN");
    log.info("weChatUnionId - > " + map);
    String result = HttpUtil.createGet(SystemConstant.weChatUnionId)
        .form(map)
        .execute()
        .body();
    log.info("微信获取unionId信息{}", result);
    Map<String, Object> resultMap = new HashMap<>();
    resultMap.put("unionId", JSONObject.parseObject(result).getString("unionid"));
    resultMap.put("nickname", JSONObject.parseObject(result).getString("nickname"));
    return resultMap;
}
```

### 重定向地址

```html
https://open.weixin.qq.com/connect/oauth2/authorize?appid=${APPID}&redirect_uri=${RedirectUrl}" +
            "&response_type=code&scope=snsapi_userinfo#wechat_redirect
```

```java
 public Map<String, Object> getRedirectUrl(@RequestBody Map<String, Object> map) {
     String url = (String) map.get("url");
     List<String> list = new ArrayList<>();
     list.add(appId);
     list.add(url);
     String redirectUrl = RedisKey.getKey(SystemConstant.weChatRedirectUrl, list);
     Map<String, Object> result = new HashMap<>();
     result.put("data", redirectUrl);
     result.put("code", SystemConstant.CODE);
     result.put("msg", SystemConstant.SUCCESS);
     return result;
 }
```

### 微信票据接口

```text
https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=${ACCESSTOKEN}&type=jsapi
```

```java
{
    //调用微信api获取票据
    List<String> ticketKey = new ArrayList<>();
    ticketKey.add(accessToken);
    ticket = HttpUtil.createGet(RedisKey.getKey(SystemConstant.weChatTicket, ticketKey))
        .execute()
        .charset("utf-8").body();
    log.info("微信端获取票据ticket={}", ticket);
}
```

### 微信获取小程序地址

```html
https://api.weixin.qq.com/wxa/generate_urllink?access_token=${ACCESSTOKEN}
```

```java
public Map<String, Object> getWeChatUrl(@RequestBody Map<String, Object> map) {
    String path = (String) map.get("path");
    String phone = (String) map.get("phone");
    String templateId = (String) map.get("templateId");
    String query = (String) map.get("query");
    String userId = (String) map.get("userId");
    //获取accessToken
    List<String> accessList = new ArrayList<>();
    accessList.add(appId);
    accessList.add(appSecret);
    String accessTokenBody = HttpUtil
        .createGet(RedisKey.getKey(SystemConstant.weChatAccessToken, accessList))
        .execute()
        .body();
    String accessToken = JSONObject.parseObject(accessTokenBody)
        .getString("access_token");
    Map<String, Object> params = new HashMap<>();
    List<String> accessTokenList = new ArrayList<>();
    accessTokenList.add(accessToken);
    params.put("expire_type", 0);
    if (!org.apache.commons.lang3.StringUtils.isBlank(path)) {
        params.put("path", path);
    }
    if (StringUtils.hasLength(query)) {
        params.put("query", query);
    }
    Map<String, String> header = new HashMap<>();
    header.put("Content-type", "application/json");
    String result;
    String url = "";
    try {
        result = HttpClientUtil
            .sendHttpRequestForPost(
            RedisKey.getKey(SystemConstant.getWeChatURL, accessTokenList),
                JSON.toJSONString(params), 5000);
        url = JSONObject.parseObject(result).getString("url_link");
        url = "&phone=" + phone + "&templateId=" + templateId + "&userId=" + userId;
    } catch (IOException e) {
        throw new RuntimeException(e);
    }
    Map<String, Object> resultMap = new HashMap<>();
    resultMap.put("data", url);
    resultMap.put("code", SystemConstant.CODE);
    resultMap.put("msg", SystemConstant.SUCCESS);
    return resultMap;
}
```

